import html2canvas from "html2canvas";
import jsPDF from "jspdf";

export default function Canvas() {
  const downloadPDF = () => {
    const paperElement = document.querySelector(".paper");

    html2canvas(paperElement, {
      scale: 5, // Very high scale for maximum resolution
      useCORS: true, // Allows cross-origin images to be rendered correctly
    }).then((canvas) => {
      const imgData = canvas.toDataURL("image/png", 1.0); // Full quality PNG output
      const pdf = new jsPDF({
        orientation: "portrait",
        unit: "cm",
        format: "a4",
        compression: "NONE", // No compression for highest quality
      });

      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      // Calculate image dimensions to fit within A4 and maintain aspect ratio
      const canvasAspectRatio = canvas.width / canvas.height;
      const pdfAspectRatio = pageWidth / pageHeight;

      let imgWidth = pageWidth;
      let imgHeight = pageHeight;

      if (canvasAspectRatio > pdfAspectRatio) {
        imgHeight = imgWidth / canvasAspectRatio;
      } else {
        imgWidth = imgHeight * canvasAspectRatio;
      }

      pdf.addImage(imgData, "PNG", 0, 0, imgWidth, imgHeight, "", "NONE"); // No compression for highest quality
      pdf.save("CV_high_quality.pdf");
    });
  };

  return (
    <div className="canvas">
      <div className="paper">
        <NameAndLinks font={"san-serif"} />
        <EducationSection font={"san-serif"} />
        <ExperienceSection font={"san-serif"} />
        <ProjectSection font={"san-serif"} />
      </div>
      <button onClick={downloadPDF}>Download as PDF</button>
    </div>
  );
}
